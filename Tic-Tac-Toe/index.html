<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Tic-Tac-Toe</h1>

    <div class="players">

        <p id="userContent">You : <span id="user"></span> </p>
        <p id="oppContent">Opp : <span id="oppName"></span> </p>

    </div>

    <br>

    <p id="valueCont">You are playing as <span id="value"></span></p>
    
    <p id="whosTurn">X's Turn</p>

    <div class="identification">
        <p id="enterName">Enter you Name : </p>
        <input type="text" placeholder="Name" id="name" >
    </div>
    <div class="container1">
        <button class="but" id="find">Search for a player</button>
    </div>
    
    <div class="img">
    <img src="loading-loading-forever.gif" id="loading" alt="">
    </div>

    <div id="bigCont">
        <div id="cont">

            <button id="btn1" class="btn"></button>
            <button id="btn2" class="btn"></button>
            <button id="btn3" class="btn"></button>
            <button id="btn4" class="btn"></button>
            <button id="btn5" class="btn"></button>
            <button id="btn6" class="btn"></button>
            <button id="btn7" class="btn"></button>
            <button id="btn8" class="btn"></button>
            <button id="btn9" class="btn"></button>

        </div>
    </div>
</body>
<script src="/socket.io/socket.io.js"></script>
<script>
    
    document.getElementById("loading").style.display="none"
    document.getElementById("bigCont").style.display="none"
    document.getElementById("userContent").style.display="none"
    document.getElementById("oppContent").style.display="none"
    document.getElementById("valueCont").style.display="none"
    document.getElementById("whosTurn").style.display="none"

    const socket=io();

    let name;
    document.getElementById("find").addEventListener("click",function(){
        name = document.getElementById("name").value
        document.getElementById("user").innerText = name

        if (name==null || name==''){
            alert("enter a name")
        }
        else
        {
            socket.emit("find", {name: name})
            document.getElementById("loading").style.display="block"
            document.getElementById("find").disabled=true
        }
    })

    socket.on("find",function(e){

        let allPlayersArray=e.allPlayers
        console.log(allPlayersArray)

        document.getElementById("userContent").style.display = "block"
        document.getElementById("oppContent").style.display = "block"
        document.getElementById("valueCont").style.display = "block"
        document.getElementById("loading").style.display = "none"
        document.getElementById("name").style.display = "none"
        document.getElementById("find").style.display = "none"
        document.getElementById("enterName").style.display = "none"
        document.getElementById("bigCont").style.display = "flex"
        document.getElementById("whosTurn").style.display = "block"


        let oppName
        let value

        const foundobj=allPlayersArray.find(obj=>obj.p1.p1name==`${name}` || obj.p2.p2name==`${name}`)

        foundobj.p1.p1name==`${name}` ? oppName=foundobj.p2.p2name : oppName=foundobj.p1.p1name
        foundobj.p1.p1name==`${name}` ? value=foundobj.p2.p2value : value=foundobj.p1.p1value

        document.getElementById("oppName").innerText=oppName
        document.getElementById("value").innerText=value

        const currentPlayer = value === "X" ? "O" : "X";
        document.getElementById("whosTurn").innerText = `${currentPlayer}'s Turn`;
        
    });
</script>
</html>